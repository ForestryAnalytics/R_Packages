Package ‘cffdrs’
October 9, 2018
Type Package
Title Canadian Forest Fire Danger Rating System
Version 1.8.1
Date 2018-09-20
Author Xianli Wang, Alan Cantin, Marc-André Parisien, Mike Wotton, Kerry
Anderson, Brett Moore, Tom Schiks, and Mike Flannigan
Maintainer Alan Cantin <Alan.Cantin@Canada.ca>
Depends R(>= 3.2.2), rgdal, raster, foreach, spatial.tools
Imports data.table, geosphere, doParallel
Description This project provides a group of new functions to calculate the
outputs of the two main components of the Canadian Forest Fire Danger Rating
System (CFFDRS) at various time scales: the Fire Weather Index (FWI) System and
the Fire Behaviour Prediction (FBP) System. Some functions have two versions,
table and raster based.
License GPL-2
URL https://r-forge.r-project.org/projects/cffdrs/
BugReports https://r-forge.r-project.org/tracker/?
func=browse&group_id=1970&atid=5372
Encoding UTF-8
RoxygenNote 6.1.0
Repository CRAN
Repository/R-Forge/Project cffdrs
Repository/R-Forge/Revision 101
Repository/R-Forge/DateTimeStamp 2018-09-20 13:15:07
Date/Publication 2018-10-09 14:00:03 UTC
NeedsCompilation no
12
cffdrs-package
R topics documented:
cffdrs-package . .
fbp . . . . . . . .
fbpRaster . . . .
fireSeason . . . .
fwi . . . . . . . .
fwiRaster . . . .
gfmc . . . . . . .
hffmc . . . . . .
hffmcRaster . . .
lros . . . . . . .
pros . . . . . . .
sdmc . . . . . . .
test_fbp . . . . .
test_fbpRaster . .
test_fwi . . . . .
test_gfmc . . . .
test_hffmc . . . .
test_lros . . . . .
test_pros . . . . .
test_rast_day01 .
test_rast_day02 .
test_rast_hour01 .
test_rast_hour02 .
test_sdmc . . . .
test_wDC . . . .
test_wDC_fs . .
wDC . . . . . . 




.
...
.
..
..
.
..
Index
cffdrs-package




.
.
..
.
..
..
.
.2
5
11
17
20
24
27
30
33
36
38
40
42
43
43
44
44
44
45
45
46
46
46
47
47
48
48
51
Canadian Forest Fire Danger Rating System
Description
The cffdrs package allows R users to calculate the outputs of the two main components of the Cana-
dian Forest Fire Danger Rating System (CFFDRS; http://cwfis.cfs.nrcan.gc.ca/background/
summary/fdr): the Fire Weather Index (FWI) System (http://cwfis.cfs.nrcan.gc.ca/background/
summary/fwi) and the Fire Behaviour Prediction (FBP) System (http://cwfis.cfs.nrcan.gc.
ca/background/summary/fbp) along with additional methods created and used Canadian fire mod-
elling. These systems are widely used internationally to assess fire danger (FWI System) and quan-
tify fire behavior (FBP System).
The FWI System (Van Wagner 1987) is based on the moisture content and the effect of wind of
three classes of forest fuels on fire behavior. It consists of six components: three fuel moisture
codes (Fire Fuel Moisture Code, Duff Moisture Code, Drought Code), and three fire behavior in-
dexes representing rate of spread (Initial Spread Index), fuel consumption (Buildup Index), and firecffdrs-package
3
intensity (Fire Weather Index). The FWI System outputs are determined from daily noon weather
observations: temperature, relative humidity, wind speed, and 24-hour rainfall.
The FBP System (Forestry Canada Fire Danger Group 1992; Hirsch 1996) provides a set of primary
and secondary measures of fire behavior. The primary outputs consist of estimates of fire spread
rate, fuel consumption, fire intensity, and fire description (i.e., surface, intermittent, or crown fire).
The secondary outputs, which are not used nearly as often, give estimates of fire area, perimeter,
perimeter growth rate, and flank and back fire behavior based on a simple elliptical fire growth
model. Unlike the FWI System, which is weather based, the FBP System also requires information
on vegetation (hereafter, fuel types) and slope (if any) to calculate its outputs. Sixteen fuel types
are included in the FBP System, covering mainly major vegetation types in Canada.
Details
Package:
Type:
Version:
Date:
License:
cffdrs
Package
1.8.1
2018-09-20
GPL-2
This package includes eleven functions. Seven functions, fwi, fwiRaster, hffmc, hffmcRaster,
sdmc, gfmc, and wDC are used for FWI System calculation, whereas two functions, fbp and fbpRaster
are used for FBP System calculation. One function, fireSeason determines fire season start and
end dates based on weather. Two functions pros and lros are rate of spread and direction cal-
culations across tiangles. These functions are not fully independent: their inputs overlap greatly
and the users will have to provide FWI System outputs to calculate FBP System outputs. The fwi,
fwiRaster, and sdmc functions calculate the outputs based on daily noon local standard time (LST)
weather observations of temperature, relative humidity, wind speed, and 24-hour rainfall, as well
as the previous day’s moisture content. The hffmc, gfmc, and hffmcRaster functions calculate the
outputs based on hourly weather observations of temperature, relative humidity, wind speed, and
hourly rainfall, as well as the previous hour’s weather conditions. The fbp and fbpRaster functions
calculate the outputs of the FBP System based on given set of information about fire weather con-
ditions (weather observations and their associated FWI System components), fuel type, and slope
(optional).
Author(s)
Xianli Wang, Alan Cantin, Marc-André Parisien, Mike Wotton, Kerry Anderson, Brett Moore, Tom
Schiks, and Mike Flannigan
Maintainer: Alan Cantin <Alan.Cantin@Canada.ca>
References
1. Van Wagner, C.E. and T.L. Pickett. 1985. Equations and FORTRAN program for the Canadian
Forest Fire Weather Index System. Can. For. Serv., Ottawa, Ont. For. Tech. Rep. 33. 18 p.
2. Van Wagner, C.E. 1987. Development and structure of the Canadian forest fire weather index
system. Forest Technology Report 35. (Canadian Forestry Service: Ottawa).4
cffdrs-package
3. Lawson, B.D. and O.B. Armitage. 2008. Weather guide for the Canadian Forest Fire Danger
Rating System. Nat. Resour. Can., Can. For. Serv., North. For. Cent., Edmonton, AB.
4. Hirsch K.G. 1996. Canadian Forest Fire Behavior Prediction (FBP) System: user’s guide. Nat.
Resour. Can., Can. For. Serv., Northwest Reg., North. For. Cent., Edmonton, Alberta. Spec. Rep.
7. 122p.
5. Forestry Canada Fire Danger Group. 1992. Development and structure of the Canadian Forest
Fire Behavior Prediction System. Forestry Canada, Ottawa, Ontario Information Report ST-X-3.
63 p. http://cfs.nrcan.gc.ca/pubwarehouse/pdfs/10068.pdf
6. Wotton, B.M., Alexander, M.E., Taylor, S.W. 2009. Updates and revisions to the 1992 Canadian
forest fire behavior prediction system. Nat. Resour. Can., Can. For. Serv., Great Lakes For. Cent.,
Sault Ste. Marie, Ontario, Canada. Information Report GLC-X-10, 45p. http://publications.
gc.ca/collections/collection_2010/nrcan/Fo123-2-10-2009-eng.pdf
7. Tymstra, C., Bryce, R.W., Wotton, B.M., Armitage, O.B. 2009. Development and structure of
Prometheus: the Canadian wildland fire growth simulation Model. Nat. Resour. Can., Can. For.
Serv., North. For. Cent., Edmonton, AB. Inf. Rep. NOR-X-417.
See Also
fbp, fireSeason, fwi, fwiRaster, gfmc, hffmc, hffmcRaster, lros, pros, sdmc, wDC
Examples
#Calculating daily FWI with wintering DC
#This exercise demonstrates how to calculate daily FWI System variables given a chronical two years
# daily fire weather observations from one weather station. In the example, we showed first how to
# decide fire season start and end dates with fireSeason, we then made overwintering DC adjustment
# with wDC for the second fire season, and eventually calculated the daily FWI System variables over
# two fire seasons with fwi. All these steps were packed up into an example user's function, which
# could be modified by various user groups. Note: the data used in this example is also the test
# data for wDC.
library(cffdrs)
#Example of a customised function to calculate fwi and
#overwinter DC. This could be further modified by
#users with various needs.
fwi_fs_wDC <- function(input){
all.fwi <- NULL
curYr.fwi <- NULL
#Create date variable
input$date <- as.Date(as.POSIXlt(paste(input$yr, "-", input$mon, "-", input$day,sep="")))
#use default fire season start and end temperature thresholds
fs <- fireSeason(input)
#Fire season dates, ordered chronologically
fs <- with(fs,fs[order(yr,mon,day),])
#Create same Date format as weather dataset for comparison
fs$date <- as.Date(as.POSIXlt(paste(fs$yr,"-",fs$mon,"-",fs$day,sep="")))
theyears <- unique(fs$yr)fbp
5
for(curYr.row in 1:length(theyears)){
#curYr.row <- 2
curYr <- theyears[curYr.row]
curYr.d <- fs[fs$yr==curYr,]
curYr.init <- data.frame(ffmc=80,dmc=10,dc=16) #set an initial startup values
#if there is more than one year of data, accumulate precipitation, then calculate overwinterDC
#and continue
if(curYr.row > 1){
#calculate the overwinter period
#end of last year's fire season
curYr.owd <- curYr.fsd[nrow(curYr.fsd),]
#rbind with beginning of current year's fire season
curYr.owd <- rbind(curYr.owd, curYr.d[1,])
#accumulate precipitation for the period between end of last and start of current
curYr.owdata <- sum(input[(input$date>curYr.owd[1,"date"] &
input$date < curYr.owd[2,"date"]),]$prec)
owDC <- wDC(DCf=tail(curYr.fwi$DC,n=1),rw=curYr.owdata) #calculate overwinter DC value
curYr.init <- data.frame(ffmc=80,dmc=10,dc=owDC) #Initialize moisture codes
}
curYr.fsd <- curYr.d[c(1,nrow(curYr.d)),]#get first and last dates of this year
#match input data to those dates for fire season data
curYr.fsdata <- input[input$yr == curYr & input$date >= curYr.fsd[1,"date"] &
input$date <= curYr.fsd[2,"date"],]
#run fwi on fireseason data
curYr.fwi <- fwi(curYr.fsdata,init=curYr.init)
#force column names to be uppercase for consistency
names(curYr.fwi) <- toupper(names(curYr.fwi))
all.fwi <- rbind(all.fwi,curYr.fwi)
}
}
all.fwi
##Usage of the custom function
# Load the test dataset, which is also the test data for wDC:
data("test_wDC")
#select 1 weather station
localWX_1 <- test_wDC[test_wDC$id==1,]
#run function with the data and fire season values
fwi_withFSwDC <- fwi_fs_wDC(localWX_1)
#Check the resulting fwi indices, calculated with a fire season start and end date, and using
#overwintered DC
fwi_withFSwDC
fbp
Fire Behavior Prediction System function6
fbp
Description
fbp calculates the outputs from the Canadian Forest Fire Behavior Prediction (FBP) System (Forestry
Canada Fire Danger Group 1992) based on given fire weather and fuel moisture conditions (from
the Canadian Forest Fire Weather Index (FWI) System (Van Wagner 1987)), fuel type, date, and
slope. Fire weather, for the purpose of FBP System calculation, comprises observations of 10 m
wind speed and direction at the time of the fire, and two associated outputs from the Fire Weather
Index System, the Fine Fuel Moisture Content (FFMC) and Buildup Index (BUI). FWI System
components can be calculated with the sister function fwi.
Usage
fbp(input, output="Primary",m=NULL,cores=1)
Arguments
input
Input
id
FuelType
LAT
LONG
FFMC
BUI
WS
GS
Dj
Aspect
The input data, a data.frame containing fuel types, fire weather component, and
slope (see below). Each vector of inputs defines a single FBP System prediction
for a single fuel type and set of weather conditions. The data.frame can be used
to evaluate the FBP System for a single fuel type and instant in time, or multiple
records for a single point (e.g., one weather station, either hourly or daily for
instance) or multiple points (multiple weather stations or a gridded surface). All
input variables have to be named as listed below, but they are case insensitive,
and do not have to be in any particular order. Fuel type is of type character;
other arguments are numeric. Missing values in numeric variables could either
be assigned as NA or leave as blank.
Required Inputs:
Description/Full name
Unique identifier of a weather station or spatial point (no restriction on
data type). Will use row.names of the Inputs dataset if not specified
FBP System Fuel Types including "C-1", "C-2", "C-3", "C-4", "C-5",
"C-6", "C-7", "D-1", "M-1", "M-2", "M-3", "M-4", "S-1", "S-2",
"S-3", "O-1a", and "O-1b". "WA" and "NF" stand for "water" and
"non-fuel", respectively. The "-" in the Fuel Type names could
be omitted, and the Fuel Type names are also case-insensitive.
Latitude [decimal degrees]
Longitude [decimal degrees]
Fine fuel moisture code [FWI System component]
Buildup index [FWI System component]
Wind speed [km/h]
Ground Slope [percent]
Julian day
Aspect of the slope [decimal degrees]
Defaults
N/A
"C2"
55
-120
90
60
10
0
180
0
Optional Inputs (1): Variables associated with certain fuel types. These could
be skippedfbp
7
if relevant fuel types do not appear in the input data.
Input
PC
PDF
cc
GFL
Full names of inputs
Percent Conifer for M1/M2 [percent]
Percent Dead Fir for M3/M4 [percent]
Percent Cured for O1a/O1b [percent]
Grass Fuel Load [kg/m^2]
Defaults
50
35
80
0.35
Optional Inputs (2): Variables that could be ignored without causing major im-
pacts to the
primary outputs
Input
CBH
WD
Accel
ELV*
BUIEff
D0
hr
ISI
CFL
FMC
SH
SD
theta
output
Full names of inputs
Crown to Base Height [m]
Wind direction [decimal degrees]
Acceleration: 1 = point, 0 = line
Elevation [meters above sea level]
Buildup Index effect: 1=yes, 0=no
Julian day of minimum Foliar Moisture Content
Hours since ignition
Initial spread index
Crown Fuel Load [kg/m^2]
Foliar Moisture Content if known [percent]
C-6 Fuel Type Stand Height [m]
C-6 Fuel Type Stand Density [stems/ha]
Elliptical direction of calculation [degrees]
Defaults
3
0
0
NA
1
0
1
0
1.0
0
0
0
0
FBP output offers 3 options (see details in Values section):
Outputs
Primary (default)
Secondary
All
Number of outputs
8
34
42
m Optimal number of pixels at each iteration of computation when nrow(input) >= 1000.
Default m = NULL, where the function will assign m = 1000 when nrow(input)
is between 1000 and 500,000, and m = 3000 otherwise. By including this op-
tion, the function is able to process large dataset more efficiently. The optimal
value may vary with different computers.
cores Number of CPU cores (integer) used in the computation, default is 1. By signing
cores > 1, the function will apply parallel computation technique provided by
the foreach package, which significantly reduces the computation time for large
input data (over a million records). For small dataset, cores=1 is actually faster.8
fbp
* Elevation is only used in the calculation of Foliar Moisture Content (FMC).
However, FMC can also be calculated without elevation input. The default is to
not use elevation in the calculation of FMC.
Details
The Canadian Forest Fire Behavior Prediction (FBP) System (Forestry Canada Fire Danger Group
1992) is a subsystem of the Canadian Forest Fire Danger Rating System, which also includes the
Canadian Forest Fire Weather Index (FWI) System. The FBP System provides quantitative esti-
mates of head fire spread rate, fuel consumption, fire intensity, and a basic fire description (e.g.,
surface, crown) for 16 different important forest and rangeland types across Canada. Using a sim-
ple conceptual model of the growth of a point ignition as an ellipse through uniform fuels and under
uniform weather conditions, the system gives, as a set of secondary outputs, estimates of flank and
back fire behavior and consequently fire area perimeter length and growth rate.
The FBP System evolved since the mid-1970s from a series of regionally developed burning indexes
to an interim edition of the nationally develop FBP system issued in 1984. Fire behavior models for
spread rate and fuel consumption were derived from a database of over 400 experimental, wild and
prescribed fire observations. The FBP System, while providing quantitative predictions of expected
fire behavior is intended to supplement the experience and judgment of operational fire managers
(Hirsch 1996).
The FBP System was updated with some minor corrections and revisions in 2009 (Wotton et al.
2009) with several additional equations that were initially not included in the system. This fbp
function included these updates and corrections to the original equations and provides a complete
suite of fire behavior prediction variables. Default values of optional input variables provide a
reasonable mid-range setting. Latitude, longitude, elevation, and the date are used to calculate foliar
moisture content, using a set of models defined in the FBP System; note that this latitude/longitude-
based function is only valid for Canada. If the Foliar Moisture Content (FMC) is specified directly
as an input, the fbp function will use this value directly rather than calculate it. This is also true of
other input variables.
Note that Wind Direction (WD) is the compass direction from which wind is coming. Wind azimuth
(not an input) is the direction the wind is blowing to and is 180 degrees from wind direction; in the
absence of slope, the wind azimuth is coincident with the direction the head fire will travel (the
spread direction azimuth, RAZ). Slope aspect is the main compass direction the slope is facing.
Slope azimuth (not an input) is the direction a head fire will spread up slope (in the absence of
wind effects) and is 180 degrees from slope aspect (Aspect). Wind direction and slope aspect are
the commonly used directional identifiers when specifying wind and slope orientation respectively.
The input theta specifies an angle (given as a compass bearing) at which a user is interested in
fire behavior predictions; it is typically some angle off of the final spread rate direction since if
for instance theta=RAZ (the final spread azimuth of the fire) then the rate of spread at angle theta
(TROS) will be equivalent to ROS.
Value
fbp returns a dataframe with primary, secondary, or all output variables, a combination of the
primary and secondary outputs.
Primary FBP output includes the following 8 variables:
CFB
Crown Fraction Burned by the head firefbp
9
CFC Crown Fuel Consumption [kg/m^2]
FD Fire description (S=Surface, I=Intermittent, C=Crown)
HFI Head Fire Intensity [kW/m]
RAZ Spread direction azimuth [degrees]
ROS Equilibrium Head Fire Rate of Spread [m/min]
SFC Surface Fuel Consumption [kg/m^2]
TFC Total Fuel Consumption [kg/m^2]
Secondary FBP System outputs include the following 34 raster layers. In order to calculate the
reliable secondary outputs, depending on the outputs, optional inputs may have to be provided.
BE BUI effect on spread rate
SF Slope Factor (multiplier for ROS increase upslope)
ISI Initial Spread Index
FFMC Fine fuel moisture code [FWI System component]
FMC Foliar Moisture Content [%]
Do Julian Date of minimum FMC
RSO Critical spread rate for crowning [m/min]
CSI Critical Surface Intensity for crowning [kW/m]
FROS Equilibrium Flank Fire Rate of Spread [m/min]
BROS Equilibrium Back Fire Rate of Spread [m/min]
HROSt Head Fire Rate of Spread at time hr [m/min]
FROSt Flank Fire Rate of Spread at time hr [m/min]
BROSt Back Fire Rate of Spread at time hr [m/min]
FCFB Flank Fire Crown Fraction Burned
BCFB Back Fire Crown Fraction Burned
FFI Equilibrium Spread Flank Fire Intensity [kW/m]
BFI Equilibrium Spread Back Fire Intensity [kW/m]
FTFC Flank Fire Total Fuel Consumption [kg/m^2]
BTFC Back Fire Total Fuel Consumption [kg/m^2]
DH Head Fire Spread Distance after time hr [m]
DB Back Fire Spread Distance after time hr [m]
DF Flank Fire Spread Distance after time hr [m]
TI Time to Crown Fire Initiation [hrs since ignition]
FTI Time to Flank Fire Crown initiation [hrs since ignition]
BTI Time to Back Fire Crown initiation [hrs since ignition]
LB Length to Breadth ratio
LBt Length to Breadth ratio after elapsed time hr
WSV Net vectored wind speed [km/hr]10
fbp
TROS* Equilibrium Rate of Spread at bearing theta [m/min]
TROSt* Rate of Spread at bearing theta at time t [m/min]
TCFB* Crown Fraction Burned at bearing theta
TFI* Fire Intensity at bearing theta [kW/m]
TTFC* Total Fuel Consumption at bearing theta [kg/m^2]
TTI* Time to Crown Fire initiation at bearing theta [hrs since ignition]
*These outputs represent fire behaviour at a point on the perimeter of an elliptical fire defined by a
user input angle theta. theta represents the bearing of a line running between the fire ignition point
and a point on the perimeter of the fire. It is important to note that in this formulation the theta
is a bearing and does not represent the angle from the semi-major axis (spread direction) of the
ellipse. This formulation is similar but not identical to methods presented in Wotton et al (2009)
and Tymstra et al (2009).
Author(s)
Xianli Wang, Alan Cantin, Marc-André Parisien, Mike Wotton, Kerry Anderson, and Mike Flanni-
gan
References
1. Hirsch K.G. 1996. Canadian Forest Fire Behavior Prediction (FBP) System: user’s guide. Nat.
Resour. Can., Can. For. Serv., Northwest Reg., North. For. Cent., Edmonton, Alberta. Spec. Rep.
7. 122p.
2. Forestry Canada Fire Danger Group. 1992. Development and structure of the Canadian Forest
Fire Behavior Prediction System. Forestry Canada, Ottawa, Ontario Information Report ST-X-3.
63 p. http://cfs.nrcan.gc.ca/pubwarehouse/pdfs/10068.pdf
3. Wotton, B.M., Alexander, M.E., Taylor, S.W. 2009. Updates and revisions to the 1992 Canadian
forest fire behavior prediction system. Nat. Resour. Can., Can. For. Serv., Great Lakes For. Cent.,
Sault Ste. Marie, Ontario, Canada. Information Report GLC-X-10, 45p. http://publications.
gc.ca/collections/collection_2010/nrcan/Fo123-2-10-2009-eng.pdf
4. Tymstra, C., Bryce, R.W., Wotton, B.M., Armitage, O.B. 2009. Development and structure of
Prometheus: the Canadian wildland fire growth simulation Model. Nat. Resour. Can., Can. For.
Serv., North. For. Cent., Edmonton, AB. Inf. Rep. NOR-X-417.
See Also
fwi, fbpRaster
Examples
library(cffdrs)
# The dataset is the standard test data for FPB system
# provided by Wotton et al (2009)
data("test_fbp")
head(test_fbp)
# id FuelType LAT LONG ELV FFMC BUI WS WD GS Dj D0
hr PC PDF GFL
#1 1
C-1 55 110 NA
90 130 20.0 0 15 182 NA 0.33333333 NA NA NAfbpRaster
11
#2 2
C2 50
90 NA
97 119 20.4 0 75 121 NA
#3 3
C-3 55 110 NA
95 30 50.0 0 0 182 NA
#4 4
C-4 55 105 200
85 82 0.0 NA 75 182 NA
#5 5
c5 55 105 NA
88 56 3.4 0 23 152 145
# cc theta Accel Aspect BUIEff CBH CFL ISI
#1 NA
0
1
270
1 NA NA
0
#2 NA
0
1
315
1 NA NA
0
#3 NA
0
1
180
1 NA NA
0
#4 NA
0
1
315
1 NA NA
0
#5 NA
0
1
180
1 NA NA
0
0.33333333
0.08333333
0.50000000
0.50000000
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
NA
#Primary output (default)
fbp(test_fbp)
#or
fbp(test_fbp,output="Primary")
#or
fbp(test_fbp,"P")
#Secondary output
fbp(test_fbp,"Secondary")
#or
fbp(test_fbp,"S")
#All output
fbp(test_fbp,"All")
#or
fbp(test_fbp,"A")
#For a single record:
fbp(test_fbp[7,])
#For a section of the records:
fbp(test_fbp[8:13,])
#fbp function produces the default values if no data is fed to
#the function:
fbp()


